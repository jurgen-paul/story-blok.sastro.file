---
import { useStoryblokApi } from "@storyblok/astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";

const storyblokApi = useStoryblokApi();

let story;
const previewStory = Astro.locals["_storyblok_preview_data"];

if (previewStory) {
  story = previewStory;
} else {
  // Fetch the story from the API if it's not available in Astro.locals
  const { slug } = Astro.params;

  const { data } = await storyblokApi.get(
    `cdn/stories/${slug === undefined ? "home" : slug}`,
    {
      version: "draft",
    }
  );

  story = data.story;
}
---

<BaseLayout>
  <StoryblokComponent blok={story.content} />
</BaseLayout>
