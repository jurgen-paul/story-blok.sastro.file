---
import {
  useStoryblok,
  useStoryblokApi,
  type ISbStoryData,
} from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";
import BaseLayout from "../layouts/BaseLayout.astro";

const { slug } = Astro.params;
let story: ISbStoryData = null;

const liveStory = await useStoryblok(Astro);
if (liveStory) {
  story = liveStory;
} else {
  const sbApi = useStoryblokApi();
  const { data } = await sbApi.get(
    `cdn/stories/${slug === undefined ? "home" : slug}`,
    {
      version: "draft",
      resolve_relations: ["featured-articles.posts"],
    }
  );
  story = data?.story;
}
---

<BaseLayout>
  <StoryblokComponent blok={story.content} />
</BaseLayout>
